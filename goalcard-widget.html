<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Goal Card Widget</title>
<style>
  :root{--bg:#0f1115;--panel:#151923;--line:#222a38;--ink:#e9ecf1;--muted:#9aa4b2;--accent:#42e6a4;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .box{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:12px}
  .head{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  input,button,select{border:1px solid var(--line);background:#0f1320;color:var(--ink);border-radius:10px;padding:8px}
  button{cursor:pointer}
  .primary{background:var(--accent);color:#071015;border:0;font-weight:700}
  .hdr{display:grid;grid-template-columns:140px 1fr 180px 140px 160px;gap:8px;color:var(--muted);font-weight:600;font-size:12px;margin:6px 0}
  .row{display:grid;grid-template-columns:140px 1fr 180px 140px 160px;gap:8px;align-items:center;padding:8px 0;border-top:1px solid var(--line)}
  .money{font-variant-numeric:tabular-nums}
  .menu{display:flex;gap:6px;align-items:center}
  .plus{width:36px;height:36px;border-radius:10px;font-size:18px;display:grid;place-items:center}
  .balance{font-weight:700}
  .prog{display:flex;align-items:center;gap:6px;justify-content:flex-end}
  .bar{width:90px;height:6px;background:#0f1320;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .fill{height:100%;background:var(--accent);width:0%}
  .pct{font-size:12px;color:var(--muted)}
  @media(max-width:900px){
    .hdr,.row{grid-template-columns:120px 1fr 160px 120px 140px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="box" id="goalcard">
    <div class="head">
      <input id="gc-name" placeholder="Goal name (e.g., Emergency Fund)" style="min-width:220px;flex:1">
      <input id="gc-target" type="number" min="1" step="1" placeholder="Target $" style="width:150px">
      <button id="gc-add" class="primary">Add Goal</button>
    </div>
    <div class="hdr">
      <div>Goal ($)</div><div>Name</div><div>Deposit</div><div>Balance</div><div>Progress</div>
    </div>
    <div id="gc-rows"></div>
  </div>
</div>

<script>
(function(){
  const SKEY='goalcard-widget-v2';
  const rowsEl=document.getElementById('gc-rows');
  const nameEl=document.getElementById('gc-name');
  const targetEl=document.getElementById('gc-target');
  document.getElementById('gc-add').addEventListener('click',addGoal);
  let goals=load();
  function load(){try{return JSON.parse(localStorage.getItem(SKEY))||[]}catch{return[]}}
  function save(){localStorage.setItem(SKEY,JSON.stringify(goals))}
  const fmt=n=>'$'+Number(n||0).toLocaleString(undefined,{maximumFractionDigits:0});
  const esc=s=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  function uid(){return Math.random().toString(36).slice(2,9)}
  function addGoal(){
    const name=nameEl.value.trim(),target=Number(targetEl.value||0);
    if(!name||!target){alert('Enter a goal name and target amount.');return}
    goals.unshift({id:uid(),name,target,balance:0});
    nameEl.value='';targetEl.value='';save();render();
  }
  function deposit(id,amt){
    const g=goals.find(x=>x.id===id);if(!g)return;
    amt=Math.max(0,Number(amt||0));if(!amt)return;
    g.balance=Math.max(0,(g.balance||0)+amt);save();render();
  }
  function render(){
    rowsEl.innerHTML='';
    goals.forEach(g=>{
      const pct=Math.max(0,Math.min(100,Math.floor((g.balance/g.target)*100)));
      const row=document.createElement('div');row.className='row';
      row.innerHTML=`
        <div class="money">${fmt(g.target)}</div>
        <div>${esc(g.name)}</div>
        <div>
          <div class="menu">
            <button class="plus" data-act="toggle" aria-label="Add deposit">＋</button>
            <select data-id="${g.id}" hidden>
              ${[5,10,20,50,100,200,500].map(v=>`<option value="${v}">$${v}</option>`).join('')}
              <option value="custom">Custom…</option>
            </select>
            <button class="primary" data-act="commit" hidden>Add</button>
          </div>
        </div>
        <div class="money balance">${fmt(g.balance)}</div>
        <div class="prog">
          <div class="bar"><div class="fill" style="width:${pct}%"></div></div>
          <span class="pct">${pct}%</span>
        </div>`;
      const plus=row.querySelector('[data-act="toggle"]');
      const sel=row.querySelector('select');
      const go=row.querySelector('[data-act="commit"]');
      plus.addEventListener('click',()=>{const show=sel.hidden;sel.hidden=!show;go.hidden=!show});
      go.addEventListener('click',()=>{
        let val=sel.value;
        if(val==='custom'){const x=prompt('Custom deposit amount ($):','25');if(!x)return;val=String(Math.max(0,Number(x||0)));}
        deposit(g.id,Number(val));
      });
      rowsEl.appendChild(row);
    });
  }
  render();
})();
</script>
</body>
</html>
